<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rangeless::fn: Transform and Adapt</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">rangeless::fn
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__transform.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Transform and Adapt</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaaae5c24201d765956eb067debdf56d64"><td class="memTemplParams" colspan="2">template&lt;typename F &gt; </td></tr>
<tr class="memitem:gaaae5c24201d765956eb067debdf56d64"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="structrangeless_1_1fn_1_1impl_1_1adapt.html">impl::adapt</a>&lt; F &gt;&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__transform.html#gaaae5c24201d765956eb067debdf56d64">rangeless::fn::adapt</a> (F fn)</td></tr>
<tr class="memdesc:gaaae5c24201d765956eb067debdf56d64"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a custom processing-stage function-object.  <a href="group__transform.html#gaaae5c24201d765956eb067debdf56d64">More...</a><br /></td></tr>
<tr class="separator:gaaae5c24201d765956eb067debdf56d64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga979427b87c75f4d09f0a6db776b47f3b"><td class="memTemplParams" colspan="2">template&lt;typename F &gt; </td></tr>
<tr class="memitem:ga979427b87c75f4d09f0a6db776b47f3b"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="structrangeless_1_1fn_1_1impl_1_1transform.html">impl::transform</a>&lt; F &gt;&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__transform.html#ga979427b87c75f4d09f0a6db776b47f3b">rangeless::fn::transform</a> (F map_fn)</td></tr>
<tr class="memdesc:ga979427b87c75f4d09f0a6db776b47f3b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a <code>seq</code> yielding results of applying the transform functions to input-elements.  <a href="group__transform.html#ga979427b87c75f4d09f0a6db776b47f3b">More...</a><br /></td></tr>
<tr class="separator:ga979427b87c75f4d09f0a6db776b47f3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a id="gaaae5c24201d765956eb067debdf56d64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaaae5c24201d765956eb067debdf56d64">&#9670;&nbsp;</a></span>adapt()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename F &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structrangeless_1_1fn_1_1impl_1_1adapt.html">impl::adapt</a>&lt;F&gt; rangeless::fn::adapt </td>
          <td>(</td>
          <td class="paramtype">F&#160;</td>
          <td class="paramname"><em>fn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a custom processing-stage function-object. </p>
<p>This is somewhat similar to <code><a class="el" href="group__transform.html#ga979427b87c75f4d09f0a6db776b47f3b" title="Create a seq yielding results of applying the transform functions to input-elements.">fn::transform</a></code>, except the correspondence between inputs and outputs is not necessarily 1:1, and instead of taking a single element to transform we take a nullary generator callable <code>gen</code> and use it to fetch however many input elements we need to generate the next output element.</p>
<p>NB: If <code>bool(gen)==false</code>, the next invocation of gen() shall throw <code><a class="el" href="structrangeless_1_1fn_1_1end__seq_1_1exception.html">fn::end_seq::exception</a></code> signaling end-of-inputs.</p>
<div class="fragment"><div class="line">        <span class="keyword">auto</span> my_transform = [](<span class="keyword">auto</span> <a class="code" href="namespacerangeless_1_1fn.html">fn</a>)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <a class="code" href="group__transform.html#gaaae5c24201d765956eb067debdf56d64">fn::adapt</a>([<a class="code" href="namespacerangeless_1_1fn.html">fn</a> = std::move(<a class="code" href="namespacerangeless_1_1fn.html">fn</a>)](<span class="keyword">auto</span> gen)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> <a class="code" href="namespacerangeless_1_1fn.html">fn</a>(gen());</div><div class="line">            });</div><div class="line">        };</div><div class="line"></div><div class="line">        <span class="keyword">auto</span> my_where = [](<span class="keyword">auto</span> pred)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <a class="code" href="group__transform.html#gaaae5c24201d765956eb067debdf56d64">fn::adapt</a>([pred = std::move(pred)](<span class="keyword">auto</span> gen)</div><div class="line">            {</div><div class="line">                <span class="keyword">auto</span> x = gen();</div><div class="line">                <span class="keywordflow">while</span>(!pred(x)) {</div><div class="line">                    x = gen();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">return</span> x;</div><div class="line">            });</div><div class="line">        };</div><div class="line"></div><div class="line">        <span class="keyword">auto</span> my_take_while = [](<span class="keyword">auto</span> pred)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <a class="code" href="group__transform.html#gaaae5c24201d765956eb067debdf56d64">fn::adapt</a>([pred = std::move(pred)](<span class="keyword">auto</span> gen)</div><div class="line">            {</div><div class="line">                <span class="keyword">auto</span> x = gen();</div><div class="line">                <span class="keywordflow">return</span> pred(x) ? std::move(x) : <a class="code" href="namespacerangeless_1_1fn.html">fn</a>::end_seq();</div><div class="line">            });</div><div class="line">        };</div><div class="line"></div><div class="line">        <span class="keyword">auto</span> my_intersperse = [](<span class="keyword">auto</span> delim)</div><div class="line">        {</div><div class="line"><span class="preprocessor">#if 1</span></div><div class="line">            <span class="keywordflow">return</span> [delim = std::move(delim)](<span class="keyword">auto</span> inputs)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> <a class="code" href="group__io.html#gab5624a94f8786cb370675a260eb51928">fn::seq</a>([  delim, </div><div class="line">                                 inputs = std::move(inputs), </div><div class="line">                                     it = inputs.end(), </div><div class="line">                                started = <span class="keyword">false</span>, </div><div class="line">                                   flag = <span class="keyword">false</span>]() <span class="keyword">mutable</span></div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span>(!started) {</div><div class="line">                        started = <span class="keyword">true</span>;</div><div class="line">                        it = inputs.begin();</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">return</span> it == inputs.end() ? <a class="code" href="structrangeless_1_1fn_1_1end__seq.html">fn::end_seq</a>()</div><div class="line">                         :     (flag = !flag) ? std::move(*it++)</div><div class="line">                         :                      delim;</div><div class="line">                });</div><div class="line">            };</div><div class="line">            </div><div class="line"><span class="preprocessor">#elif 0 // or</span></div><div class="line"></div><div class="line">            <span class="keywordflow">return</span> [delim = std::move(delim)](<span class="keyword">auto</span> inputs)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> std::move(inputs)</div><div class="line">              % <a class="code" href="group__transform.html#ga979427b87c75f4d09f0a6db776b47f3b">fn::transform</a>([delim](<span class="keyword">auto</span> inp)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">return</span> std::array&lt;decltype(inp), 2&gt;{{ std::move(inp), delim }};</div><div class="line">                })</div><div class="line">              % <a class="code" href="group__concat.html#gac6a26ae2179802d847910eaa00daac7f">fn::concat</a>()</div><div class="line">              % <a class="code" href="group__filtering.html#gac37eb5de357758627f1f48e045645f92">fn::drop_last</a>(); <span class="comment">// drop trailing delim</span></div><div class="line">            };</div><div class="line"></div><div class="line"><span class="preprocessor">#else // or</span></div><div class="line"></div><div class="line">            <span class="keywordflow">return</span> <a class="code" href="group__transform.html#gaaae5c24201d765956eb067debdf56d64">fn::adapt</a>([delim, flag = <span class="keyword">false</span>](<span class="keyword">auto</span> gen) <span class="keyword">mutable</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span>           !gen ? <a class="code" href="structrangeless_1_1fn_1_1end__seq.html">fn::end_seq</a>() </div><div class="line">                     : (flag = !flag) ? gen() </div><div class="line">                     :                  delim;</div><div class="line">            });</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        };</div><div class="line"></div><div class="line"></div><div class="line">        <span class="keyword">auto</span> my_inclusive_scan = []</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <a class="code" href="group__transform.html#gaaae5c24201d765956eb067debdf56d64">fn::adapt</a>([sum = 0](<span class="keyword">auto</span> gen) <span class="keyword">mutable</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> sum += gen();</div><div class="line">            });</div><div class="line">        };</div><div class="line"></div><div class="line">        <span class="keyword">auto</span> res = </div><div class="line">            <a class="code" href="group__io.html#gab5624a94f8786cb370675a260eb51928">fn::seq</a>([i = 0]() <span class="keyword">mutable</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> i++;</div><div class="line">            })                  <span class="comment">// 0,1,2,3,...</span></div><div class="line"></div><div class="line">          % my_where([](<span class="keywordtype">int</span> x)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> x &gt;= 3; </div><div class="line">            })                  <span class="comment">// 3,4,5,...</span></div><div class="line"></div><div class="line">          % my_take_while([](<span class="keywordtype">int</span> x)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> x &lt;= 5;</div><div class="line">            })                  <span class="comment">// 3,4,5</span></div><div class="line"></div><div class="line">          % my_intersperse(-1)  <span class="comment">// 3,-1,4,-1,5</span></div><div class="line"></div><div class="line">          % my_transform([](<span class="keywordtype">int</span> x)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> x + 1;</div><div class="line">            })                  <span class="comment">// 4,0,5,0,6</span></div><div class="line"></div><div class="line">          % my_inclusive_scan() <span class="comment">// 4,4,9,9,15</span></div><div class="line"></div><div class="line">          % <a class="code" href="group__to__vec.html#gaed63bb21cc79709c4d88a9d385a13aaf">fn::to_vector</a>();</div><div class="line"></div><div class="line">        VERIFY((res == vec_t{{4, 4, 9, 9, 15}}));</div></div><!-- fragment --><p>A more realistic example: suppose you have a pipeline transforming inputs to outputs in parallel, and you want to compress the output, but the outputs are small and compressing them individually would be ineffective, and you want to serialize the incoming results into a buffer of some minimum size, e.g. 100kb, before passing it to the compressing stage. </p><div class="fragment"><div class="line">  <span class="keyword">auto</span> make_result     = [](std::string s){ <span class="keywordflow">return</span> s; };</div><div class="line">  <span class="keyword">auto</span> compress_block  = [](std::string s){ <span class="keywordflow">return</span> s; };</div><div class="line">  <span class="keyword">auto</span> write_to_ostr   = [](std::string s){ std::cout &lt;&lt; s; };</div><div class="line"></div><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacerangeless_1_1fn.html">fn</a> = <a class="code" href="namespacerangeless_1_1fn.html">rangeless::fn</a>;</div><div class="line">  <span class="keyword">using</span> fn::operators::operator%;</div><div class="line"></div><div class="line">  <a class="code" href="group__io.html#gab5624a94f8786cb370675a260eb51928">fn::seq</a>([&amp;]() -&gt; std::string</div><div class="line">  {</div><div class="line">      std::string line;</div><div class="line">      <span class="keywordflow">return</span> std::getline(std::cin, line) ? std::move(line) </div><div class="line">                                          : <a class="code" href="namespacerangeless_1_1fn.html">fn</a>::end_seq();</div><div class="line">  })</div><div class="line"></div><div class="line">% <a class="code" href="group__parallel.html#ga406bfcec6a4930bdc714536bf35e7f46">fn::transform_in_parallel</a>(make_result)</div><div class="line"></div><div class="line">% <a class="code" href="group__transform.html#gaaae5c24201d765956eb067debdf56d64">fn::adapt</a>([](<span class="keyword">auto</span> get_next)</div><div class="line">  { </div><div class="line">      std::ostringstream buf{};</div><div class="line"></div><div class="line">      <span class="keywordflow">while</span>(get_next &amp;&amp; buf.tellp() &lt; 100000) {</div><div class="line">          buf &lt;&lt; get_next();</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="keywordflow">return</span> buf.tellp() ? buf.str() : <a class="code" href="structrangeless_1_1fn_1_1end__seq.html">fn::end_seq</a>();</div><div class="line">  })</div><div class="line"></div><div class="line">% <a class="code" href="group__parallel.html#ga406bfcec6a4930bdc714536bf35e7f46">fn::transform_in_parallel</a>(compress_block)</div><div class="line"></div><div class="line">% <a class="code" href="group__folding.html#ga8568617f52b0e084f2c1303d71705b69">fn::for_each</a>(write_to_ostr);</div></div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="fn_8hpp_source.html#l03657">3657</a> of file <a class="el" href="fn_8hpp_source.html">fn.hpp</a>.</p>

</div>
</div>
<a id="ga979427b87c75f4d09f0a6db776b47f3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga979427b87c75f4d09f0a6db776b47f3b">&#9670;&nbsp;</a></span>transform()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename F &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structrangeless_1_1fn_1_1impl_1_1transform.html">impl::transform</a>&lt;F&gt; rangeless::fn::transform </td>
          <td>(</td>
          <td class="paramtype">F&#160;</td>
          <td class="paramname"><em>map_fn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a <code>seq</code> yielding results of applying the transform functions to input-elements. </p>
<p>Returns a unary function-object, which will capture the arg by value and return an adapted <code>seq&lt;...&gt;</code> which will yield results of invoking <code>map_fn</code> on the elements (passed by value) of arg. See <code><a class="el" href="group__filtering.html#ga85f0d030462ff19ba023f92d2b111210" title="Filter elements.">fn::where</a></code> for an example. </p>

<p class="definition">Definition at line <a class="el" href="fn_8hpp_source.html#l03670">3670</a> of file <a class="el" href="fn_8hpp_source.html">fn.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
